(window.webpackJsonp=window.webpackJsonp||[]).push([[13],{edxm:function(t,n,e){"use strict";e.r(n);var s,l=e("CcnG"),i=e("mrSG"),r=e("t/Na"),o=function(){function t(t){this.http=t,this.host="https://nix.ltd",this.apiHost=this.host+"/api/v1",this.urls={subscribe:this.apiHost+"/stripe/subscribe",charge:this.apiHost+"/stripe/charge",subscribeAccept:this.apiHost+"/stripe/subscribeComplete",isActive:this.apiHost+"/stripe/subscription/active",mySubscription:this.apiHost+"/stripe/subscription/getMy",getPlan:this.apiHost+"/stripe/getPlans",notifyStatus:this.apiHost+"/notifications/status"},console.log("Api Provider"),console.log("Setting new host"+s),this.setHost(s)}return t.prototype.setHost=function(t){void 0!==t&&(this.host=t,this.apiHost=this.host+"/api/v1")},t.prototype.getToken=function(){return t.token},t.prototype.charge=function(){return i.b(this,void 0,void 0,function(){return i.e(this,function(t){return[2,this.http.get(this.urls.charge,{headers:{Token:this.getToken()}})]})})},t.prototype.subscribe=function(t,n,e){return i.b(this,void 0,void 0,function(){return i.e(this,function(t){return[2]})})},t.prototype.getApiHost=function(){return this.apiHost},t.prototype.getTokens=function(t){return this.http.get("http://localhost/stripe/"+t)},t.prototype.confirm=function(t,n){var e=(new r.g).set("token",t).set("regNumb",n);return this.http.get("http://localhost/confirm",{headers:e})},t.token="token",t.selectedTab=0,t.ngInjectableDef=l.Ob({factory:function(){return new t(l.Pb(r.c))},token:t,providedIn:"root"}),t}(),u=function(){function t(t,n){this.purchaseServie=t,this.route=n,this.message="",this.stripe=Stripe("pk_test_DXtuhrwBCTqVo7v0OBaCzArG"),this.cards={number:"4242424242424242",expMonth:"12",expYear:"21",cvc:"123"},this.card=null,this.elements=null,this.token=null}return t.prototype.Submit=function(){return i.b(this,void 0,void 0,function(){var t,n,e,s=this;return i.e(this,function(l){switch(l.label){case 0:return this.message="",[4,this.stripe.createPaymentMethod("card",this.cardElement)];case 1:return t=l.sent(),n=t.paymentMethod,(e=t.error)?console.log("ERROR"+e):(console.log(n),this.purchaseServie.confirm(n.id,this.regNumb).subscribe(function(t){console.log(t),s.handleServerResponse(t)})),[2]}})})},t.prototype.ngOnInit=function(){var t=this;this.route.params.subscribe(function(n){t.regNumb=n.regNumb}),this.elements=this.stripe.elements(),this.cardElement=this.elements.create("card"),this.cardElement.mount("#card-element")},t.prototype.handleServerResponse=function(t){return i.b(this,void 0,void 0,function(){var n,e,s=this;return i.e(this,function(l){switch(l.label){case 0:return t.error?(console.log("response.error"),[3,4]):[3,1];case 1:return t.requires_action?(console.log("require"),[4,this.stripe.handleCardAction(t.payment_intent_client_secret)]):[3,3];case 2:return n=l.sent(),e=n.paymentIntent,n.error?(this.message="Err",console.log("ActionError")):this.purchaseServie.confirm(e.id,this.regNumb).subscribe(function(t){s.handleServerResponse(t)}),[3,4];case 3:this.message="SUCCESS",console.log("handle  success"),l.label=4;case 4:return[2]}})})},t}(),c=function(){return function(){}}(),h=e("pMnS"),a=e("oBZk"),p=e("ZZ/e"),b=e("ZYCi"),d=l.rb({encapsulation:0,styles:[[""]],data:{}});function f(t){return l.Lb(0,[(t()(),l.tb(0,0,null,null,6,"ion-header",[],null,null,null,a.v,a.f)),l.sb(1,49152,null,0,p.y,[l.h,l.k,l.z],null,null),(t()(),l.tb(2,0,null,0,4,"ion-toolbar",[],null,null,null,a.F,a.p)),l.sb(3,49152,null,0,p.yb,[l.h,l.k,l.z],null,null),(t()(),l.tb(4,0,null,0,2,"ion-title",[],null,null,null,a.E,a.o)),l.sb(5,49152,null,0,p.wb,[l.h,l.k,l.z],null,null),(t()(),l.Jb(-1,0,["purchase"])),(t()(),l.tb(7,0,null,null,9,"ion-content",[],null,null,null,a.t,a.d)),l.sb(8,49152,null,0,p.r,[l.h,l.k,l.z],null,null),(t()(),l.tb(9,0,null,0,1,"div",[["id","card-element"]],null,null,null,null,null)),(t()(),l.Jb(-1,null,[" A Stripe Element will be inserted here. "])),(t()(),l.tb(11,0,null,0,0,"div",[["id","payment-request-button"]],null,null,null,null,null)),(t()(),l.tb(12,0,null,0,2,"ion-button",[["color","success"]],null,[[null,"click"]],function(t,n,e){var s=!0;return"click"===n&&(s=!1!==t.component.Submit()&&s),s},a.r,a.b)),l.sb(13,49152,null,0,p.h,[l.h,l.k,l.z],{color:[0,"color"]},null),(t()(),l.Jb(-1,0,["Buy"])),(t()(),l.tb(15,0,null,0,1,"h1",[],null,null,null,null,null)),(t()(),l.Jb(16,null,["",""]))],function(t,n){t(n,13,0,"success")},function(t,n){t(n,16,0,n.component.message)})}function m(t){return l.Lb(0,[(t()(),l.tb(0,0,null,null,1,"app-purchase",[],null,null,null,f,d)),l.sb(1,114688,null,0,u,[o,b.a],null,null)],function(t,n){t(n,1,0)},null)}var g=l.pb("app-purchase",u,m,{},{},[]),v=e("Ip0R"),y=e("gIcY");e.d(n,"PurchasePageModuleNgFactory",function(){return k});var k=l.qb(c,[],function(t){return l.Bb([l.Cb(512,l.j,l.ab,[[8,[h.a,g]],[3,l.j],l.x]),l.Cb(4608,v.l,v.k,[l.u,[2,v.s]]),l.Cb(4608,y.i,y.i,[]),l.Cb(4608,p.a,p.a,[l.z,l.g]),l.Cb(4608,p.Cb,p.Cb,[p.a,l.j,l.q]),l.Cb(4608,p.Fb,p.Fb,[p.a,l.j,l.q]),l.Cb(1073742336,v.b,v.b,[]),l.Cb(1073742336,y.h,y.h,[]),l.Cb(1073742336,y.b,y.b,[]),l.Cb(1073742336,p.Ab,p.Ab,[]),l.Cb(1073742336,b.p,b.p,[[2,b.u],[2,b.m]]),l.Cb(1073742336,c,c,[]),l.Cb(1024,b.k,function(){return[[{path:"",component:u}]]},[])])})}}]);